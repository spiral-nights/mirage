openapi: 3.0.3
info:
  title: Mirage API
  description: |
    Build social apps with just `fetch()`. Mirage handles authentication,
    encryption, and syncing across devices automatically.

    **No backend required** - data syncs via decentralized relays.
  version: 1.0.0
  contact:
    name: Mirage
  license:
    name: MIT

servers:
  - url: /mirage/v1
    description: API base URL

tags:
  - name: System
    description: Check if the API is ready to use
  - name: Feed
    description: Read and post public messages (like tweets)
  - name: Users
    description: Get user profiles and display names
  - name: Storage
    description: |
      Save and load app data (settings, drafts, preferences).
      Data syncs across all your devices automatically.

      **Space Required:** All storage operations require a Space context.
      Apps must be launched within a Space to use storage. This ensures
      complete data isolation between different instances of the same app.
  - name: Spaces
    description: |
      Access the current Space context and its shared data.
      Use `GET /space` to get the current context, and `/space/store`
      for collaborative key-value storage between Space members.

      **Note:** Apps cannot create or manage Spaces directly.
      Use the Admin endpoints for Space management.
  - name: Admin
    description: |
      Administrative endpoints for Space management. These are restricted
      to the Mirage management system (`appOrigin === 'mirage'`).

      Regular apps calling these endpoints will receive a 403 Forbidden error.
  - name: DirectMessages
    description: |
      Private one-on-one messages. Fully encrypted - only you and the
      recipient can read them.
  - name: Contacts
    description: |
      Manage your social graph (following list). Add or remove friends
      and see who other users are following.

paths:
  /ready:
    get:
      tags: [System]
      summary: Check if API is ready
      description: |
        Returns status information. Check this endpoint once at startup
        to ensure the system is online before making API calls.

        **Usage:**
        ```javascript
        const status = await fetch('/mirage/v1/ready').then(r => r.json());
        if (status.ready) {
          // Start using API
        }
        ```
      operationId: getReady
      responses:
        '200':
          description: System is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  ready:
                    type: boolean
                    description: Always true when endpoint responds
                  authenticated:
                    type: boolean
                    description: Whether the user has signed in
                  relayCount:
                    type: integer
                    description: Number of active network connections

  /events:
    get:
      tags: [System]
      summary: Query events
      description: |
        Low-level query interface for raw Nostr events.
        Use this to fetch specific kinds of data (notes, profiles, etc).

        **Common Queries:**
        - **Feed:** `kinds=[1]`
        - **Profiles:** `kinds=[0], authors=[pk]`
      operationId: getEvents
      parameters:
        - name: kinds
          in: query
          description: Event kinds to filter by (e.g. 1 for notes)
          schema:
            type: array
            items:
              type: integer
        - name: authors
          in: query
          description: Public keys of authors to filter by
          schema:
            type: array
            items:
              type: string
        - name: since
          in: query
          description: Only return events newer than this timestamp
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: array
                items:
                   $ref: '#/components/schemas/NostrEvent'
              example:
                - id: "4376c..."
                  kind: 1
                  content: "Hello Nostr!"
                  pubkey: "abc..."
                  created_at: 1678886400
                  tags: []

    post:
      tags: [System]
      summary: Publish raw event
      description: |
        Publish a raw Nostr event. The system will sign it and broadcast to relays.
        Useful for custom event kinds not covered by helper endpoints.
      operationId: publishEvent
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content, kind]
              properties:
                kind:
                  type: integer
                  description: Event kind (e.g. 1 for note)
                content:
                  type: string
                  description: Event content
                tags:
                  type: array
                  items:
                    type: array
                    items:
                      type: string
      responses:
        '201':
          description: Event published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NostrEvent'

  /user/me:
    get:
      tags: [Users]
      summary: Get current user profile
      description: Returns the profile of the currently authenticated user.
      operationId: getCurrentUser
      security:
        - nip07: []
      responses:
        '200':
          description: Your profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileContent'
        '401':
          description: Not authenticated

  /users/{pubkey}:
    get:
      tags: [Users]
      summary: Get user profile
      description: |
        Fetch a user's profile metadata (Kind 0).
        This includes name, bio, avatar, and other NIP-01 fields.
      operationId: getUser
      parameters:
        - name: pubkey
          in: path
          required: true
          description: Hex public key or npub
          schema:
            type: string
            example: "39fe47...a6835c2f"
      responses:
        '200':
          description: User profile found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileContent'
              example:
                pubkey: "39fe47..."
                name: "Alice"
                about: "Crypto enthusiast"
                picture: "https://example.com/alice.jpg"
                nip05: "alice@example.com"

  /contacts:
    get:
      tags: [Contacts]
      summary: Get my contacts
      description: Returns the list of people you follow (Kind 3).
      operationId: getContacts
      security:
        - nip07: []
      responses:
        '200':
          description: Your contact list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Contact'
        '404':
          description: No contact list found

    put:
      tags: [Contacts]
      summary: Update contact list
      description: |
        Replace your entire contact list.
        To add a user, fetch the current list, append the new user, and PUT the result.
      operationId: updateContacts
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [contacts]
              properties:
                contacts:
                  type: array
                  items:
                    $ref: '#/components/schemas/Contact'
      responses:
        '200':
          description: Contact list updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /contacts/{pubkey}:
    get:
      tags: [Contacts]
      summary: Get user's contacts
      description: See who another user is following.
      operationId: getUserContacts
      parameters:
        - name: pubkey
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User's contact list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Contact'

  /space/me/{key}:
    get:
      tags: [Spaces]
      summary: Get personal value in Space
      description: |
        Retrieves a value from your **personal storage** (User-only)
        within the current Space context. This data is isolated per app,
        per space, and per user.

        Use this for personal notes, app settings, or drafts that
        other members of the Space should not see.
      operationId: getSpaceMe
      security:
        - nip07: []
      parameters:
        - name: key
          in: path
          required: true
          description: Storage key
          schema:
            type: string
            example: "my-draft"
        - name: pubkey
          in: query
          required: false
          description: Read another user's public storage if they used ?public=true
          schema:
            type: string
      responses:
        '200':
          description: Personal value retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageValue'
        '401':
          description: Not authenticated
        '404':
          description: Key not found

    put:
      tags: [Spaces]
      summary: Store personal value in Space
      description: |
        Stores a value in your **personal storage** (User-only)
        within the current Space context.

        By default, data is **encrypted** to your public key (NIP-44).
      operationId: putSpaceMe
      security:
        - nip07: []
      parameters:
        - name: key
          in: path
          required: true
          description: Storage key
          schema:
            type: string
            example: "my-draft"
        - name: public
          in: query
          required: false
          description: |
            If "true", stores data in plaintext. Useful for data you want
            others to discover (e.g., your space-specific bio or badge)
            while still being the only one who can edit it.
          schema:
            type: string
            enum: ["true", "false"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: JSON value to store
      responses:
        '200':
          description: Value stored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageValue'

    delete:
      tags: [Spaces]
      summary: Delete personal value in Space
      operationId: deleteSpaceMe
      security:
        - nip07: []
      parameters:
        - name: key
          in: path
          required: true
          description: Storage key to delete
          schema:
            type: string
      responses:
        '200':
          description: Value deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean
                  key:
                    type: string
        '401':
          description: Not authenticated
        '503':
          description: Relay pool not initialized

  # ===========================================================================
  # Spaces
  # ===========================================================================

  /space:
    get:
      tags: [Spaces]
      summary: Get current space context
      description: |
        Returns the metadata of the space the app is currently running in.

        If the app was launched inside a space, this returns the space details.
        If the app is running standalone (or if no space context was provided),
        it returns `{ "id": null, "standalone": true }`.

        **Usage:**
        Use this to check if your app has access to a space context.
      operationId: getSpaceContext
      responses:
        '200':
          description: Current space context
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Space'
                  - $ref: '#/components/schemas/SpaceContextStandalone'

    put:
      tags: [Spaces]
      summary: Set current space context
      description: |
        Set the active Space for this session. After calling this, all
        implicit Space operations (`/storage`, `/space/store`, etc.) will
        use this Space.

        **Standalone Apps:** Apps running outside the Mirage UI can use this
        endpoint to set their Space context.
      operationId: setSpaceContext
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [spaceId]
              properties:
                spaceId:
                  type: string
                  description: The Space ID to activate
                spaceName:
                  type: string
                  description: Optional display name for the Space
      responses:
        '200':
          description: Space context set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  spaceId:
                    type: string
                  spaceName:
                    type: string
        '400':
          description: spaceId is required

  /space/store:
    get:
      tags: [Spaces]
      summary: Get shared KV store for current space
      description: |
        Returns the clean, flattened state (JSON) of the shared key-value
        store for the currently active space.
      operationId: getImplicitSpaceStore
      responses:
        '200':
          description: Space data snapshot
          content:
            application/json:
              schema:
                type: object
        '400':
          description: No space context set

  /space/store/{key}:
    put:
      tags: [Spaces]
      summary: Update shared KV store key for current space
      description: |
        Updates a specific key in the shared store for the current space.
        This emits a Kind 42 event with the key and value.
      operationId: updateImplicitSpaceStore
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Value updated
        '400':
          description: No space context set

  /space/messages:
    get:
      tags: [Spaces]
      summary: Get chat messages for current space
      description: |
        Returns a time-ordered list of encrypted messages from the
        active space context. Supports `EventSource` for real-time chat.
      operationId: getImplicitSpaceMessages
      responses:
        '200':
          description: Message history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NostrEvent'
    post:
      tags: [Spaces]
      summary: Post a message to current space
      operationId: postImplicitSpaceMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
      responses:
        '201':
          description: Message sent

  /space/invitations:
    post:
      tags: [Spaces]
      summary: Invite user to current space (system message)
      operationId: postImplicitSpaceInvitation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [pubkey]
              properties:
                pubkey:
                  type: string
                  description: Public key to invite
                name:
                  type: string
                  description: Optional name for the user
      responses:
        '201':
          description: Invitation sent







  /spaces:
    get:
      deprecated: true
      tags: [Spaces]
      summary: "[DEPRECATED] List my spaces - use /admin/spaces"
      description: |
        **DEPRECATED:** Use `GET /admin/spaces` instead.
        Returns all spaces you're a member of.
      operationId: listSpaces
      security:
        - nip07: []
      responses:
        '200':
          description: Your spaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Space'

    post:
      tags: [Spaces]
      summary: Create a space
      description: |
        Start a new shared space. You'll be the owner.
        Invite others using the invite endpoint.
      operationId: createSpace
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  description: Name for the space (e.g., "Family Groceries")
                  example: "Family Space"
      responses:
        '201':
          description: Space created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Space'

  /spaces/{spaceId}:
    delete:
      tags: [Spaces]
      summary: Delete or leave a space
      description: Deletes the space if you are the owner, or removes you from it.
      operationId: deleteSpace
      security:
        - nip07: []
      parameters:
        - name: spaceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Space deleted/left
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean





  # ===========================================================================
  # Direct Messages (NIP-17)
  # ===========================================================================

  /dms:
    get:
      tags: [DirectMessages]
      summary: List your conversations
      description: See everyone you've messaged privately.
      operationId: listConversations
      security:
        - nip07: []
      responses:
        '200':
          description: Your private conversations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Conversation'

  /dms/{pubkey}/messages:
    get:
      tags: [DirectMessages]
      summary: Get messages with someone
      description: |
        Get your private conversation with a specific person. Supports real-time streaming.

        **Streaming (recommended):**
        ```javascript
        const es = new EventSource('/mirage/v1/dms/{pubkey}');
        es.onmessage = (event) => console.log(JSON.parse(event.data));
        ```
      operationId: getDirectMessages
      security:
        - nip07: []
      parameters:
        - name: pubkey
          in: path
          required: true
          description: The other person's ID
          schema:
            type: string
        - name: since
          in: query
          description: Only return messages newer than this time
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DirectMessage'
            text/event-stream:
              schema:
                $ref: '#/components/schemas/EventStream'

    post:
      tags: [DirectMessages]
      summary: Send a private message
      description: Send an encrypted message to someone. Only they can read it.
      operationId: sendDirectMessage
      security:
        - nip07: []
      parameters:
        - name: pubkey
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
      responses:
        '201':
          description: Message sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectMessage'

  # ===========================================================================
  # Admin (Mirage Management)
  # ===========================================================================

  /admin/apps:
    get:
      tags: [Admin]
      summary: List apps in library (Admin Only)
      description: |
        Returns the list of installed apps.
        This is used by the Mirage launcher to show available apps.
      operationId: adminListApps
      security:
        - nip07: []
      responses:
        '200':
          description: List of apps
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppDefinition'

    post:
      tags: [Admin]
      summary: Add app to library (Admin Only)
      description: |
        Installs an existing app into the Mirage library.
        The app must have a valid NIP-19 `naddr`.

        Note: This does **not** publish the app's HTML to relays.
        Use `POST /admin/apps/publish` to publish an app.
      operationId: adminAddApp
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [naddr]
              properties:
                naddr:
                  type: string
                  description: NIP-19 address code
      responses:
        '201':
          description: App installed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppDefinition'

  /admin/apps/publish:
    post:
      tags: [Admin]
      summary: Publish an app (Admin Only)
      description: |
        Publishes a Mirage app as a Kind 30078 addressable event and adds it to the Mirage library.

        This endpoint replaces using the generic `POST /events` route for app publishing.
      operationId: adminPublishApp
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [html]
              properties:
                html:
                  type: string
                  description: Full app HTML (srcdoc)
                name:
                  type: string
                  description: Display name for the library
                existingDTag:
                  type: string
                  description: Optional stable identifier to update an existing app
      responses:
        '201':
          description: App published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppDefinition'

  /admin/apps/{naddr}:
    delete:
      tags: [Admin]
      summary: Remove app from library (Admin Only)
      operationId: adminRemoveApp
      security:
        - nip07: []
      parameters:
        - name: naddr
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: App removed

  /admin/spaces:
    get:
      tags: [Admin]
      summary: List ALL spaces across all apps (Admin Only)
      operationId: adminListAllSpaces
      responses:
        '200':
          description: All spaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Space'
    post:
      tags: [Admin]
      summary: Create a space (Admin Only)
      operationId: adminCreateSpace
      security:
        - nip07: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
       responses:
        '201':
          description: Space created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Space'

  /admin/spaces/{spaceId}:
    put:
      tags: [Admin]
      summary: Update space details (Admin Only)
      operationId: adminUpdateSpace
      parameters:
        - name: spaceId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                icon:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Space updated

    delete:
      tags: [Admin]
      summary: Force delete a space (Admin Only)
      description: |
        Deletes the space and all associated data.
        As admin, this bypasses some checks but is still destructive.
      operationId: adminDeleteSpace
      parameters:
        - name: spaceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Space deleted

  /admin/spaces/{spaceId}/invitations:
    post:
      tags: [Admin]
      summary: Invite user to space (Admin Only)
      operationId: adminInviteMember
      parameters:
        - name: spaceId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [pubkey]
              properties:
                pubkey:
                  type: string
                name:
                  type: string
      responses:
        '201':
          description: Invitation sent

  /admin/state:
    delete:
      tags: [Admin]
      summary: Reset all Mirage data (Admin Only)
      description: |
        **DANGEROUS:** Wipes all Mirage-related data stored in Nostr relays,
        including app library, space keys, and personal storage.
        This action is irreversible.
      operationId: adminResetState
      security:
        - nip07: []
      responses:
        '200':
          description: System reset complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  deletedCount:
                    type: integer
                  keys:
                    type: array
                    items:
                      type: string

components:
  securitySchemes:
    nip07:
      type: apiKey
      in: header
      name: X-User-Auth
      description: |
        Automatic browser authentication. The Mirage environment handles
        user identity and signing securely. Apps don't need to implement this.

  schemas:
    # =========================================================================
    # Nostr Core Schemas
    # =========================================================================

    NostrEvent:
      type: object
      required: [id, pubkey, created_at, kind, content, tags]
      properties:
        id:
          type: string
          description: 32-byte hex ID
        pubkey: 
          type: string
          description: Author's public key
        created_at:
          type: integer
          description: Unix timestamp
        kind:
          type: integer
          description: Event kind (0=Metadata, 1=Text, 3=Contacts, etc)
        tags:
          type: array
          items:
            type: array
            items:
              type: string
        content:
          type: string
          description: Payload string (JSON for kind 0/3, text for kind 1)
        sig:
          type: string
          description: Schnorr signature

    ProfileContent:
      type: object
      description: Parsed content of a Kind 0 Metadata event
      properties:
        pubkey:
          type: string
          description: User's public key
        name:
          type: string
          description: Short username
        displayName:
          type: string
          description: Full display name
        about:
          type: string
          description: Bio / Description
        picture:
          type: string
          format: uri
          description: Avatar URL
        banner:
          type: string
          format: uri
          description: Banner image URL
        website:
          type: string
          format: uri
        nip05:
          type: string
          description: NIP-05 Verification ID (user@domain.com)
        lud16:
          type: string
          description: Lightning Address (user@domain.com)

    # =========================================================================
    # App Storage (NIP-78)
    # =========================================================================

    StorageValue:
      type: object
      description: Stored app data (settings, preferences, etc.)
      required: [key, value, updatedAt]
      properties:
        key:
          type: string
          description: Name of the setting or data item
          example: "settings"
        value:
          description: The stored value (any JSON type)
          example: {"theme": "dark", "notifications": true}
        updatedAt:
          type: integer
          description: Unix timestamp of last update
          example: 1703203200

    # =========================================================================
    # Streaming
    # =========================================================================

    EventStream:
      type: string
      description: |
        Server-Sent Events (SSE) stream.
        Each message starts with `data: ` and ends with `\n\n`.
      example: |
        data: {"id":"123", "content":"Hello"}

        data: {"id":"124", "content":"World"}

    Error:
      type: object
      required: [error]
      properties:
        error:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code (optional)
          example: "AUTH_REQUIRED"

    # =========================================================================
    # Spaces
    # =========================================================================

    Space:
      type: object
      description: A shared encrypted workspace
      properties:
        id:
          type: string
          description: Space identifier
        name:
          type: string
          description: Space display name
        createdAt:
          type: integer
          description: Unix timestamp
        memberCount:
          type: integer
          description: Number of members
        owner:
          type: string
          description: Owner's public key
        members:
          type: array
          items:
            type: string
          description: List of member public keys

    SpaceContextStandalone:
      type: object
      description: Context returned when an app is running without a space
      properties:
        id:
          type: null
        standalone:
          type: boolean
          example: true

    SpaceMessage:
      type: object
      description: A message in a space (regular or system)
      required: [id, spaceId, author, content, type, createdAt]
      properties:
        id:
          type: string
          description: Unique event identifier
        spaceId:
          type: string
          description: ID of the space
        author:
          type: string
          description: Sender's public key
        content:
          type: string
          description: |
            For regular messages: the decrypted message text.
            For system messages: JSON-encoded SystemEvent.
        type:
          type: string
          enum: [message, system]
          description: |
            - `message`: Regular user message
            - `system`: System notification (member joined, left, etc.)
        createdAt:
          type: integer
          description: Unix timestamp

    StoreUpdate:
      type: object
      description: Real-time update for the Shared KV Store
      required: [key, value]
      properties:
        key:
          type: string
          description: The key that changed
        value:
          description: The new JSON value

    SystemEvent:
      type: object
      description: Payload for system messages (parsed from content when type=system)
      required: [action]
      properties:
        action:
          type: string
          enum: [member_joined, space_created, space_renamed]
          description: Type of system event
        pubkey:
          type: string
          description: Affected member's public key
        invitedBy:
          type: string
          description: Who invited the member
        name:
          type: string
          description: Space name
        createdBy:
          type: string
          description: Who created the space
        oldName:
          type: string
          description: Previous name
        newName:
          type: string
          description: New name

    SpaceMember:
      type: object
      properties:
        pubkey:
          type: string
        name:
          type: string
          description: Display name if known
        joinedAt:
          type: integer

    # =========================================================================
    # Direct Messages
    # =========================================================================

    Conversation:
      type: object
      properties:
        pubkey:
          type: string
          description: Other party's pubkey
        name:
          type: string
          description: Display name if known
        lastMessage:
          type: string
          description: Preview of last message
        lastMessageAt:
          type: integer
        unreadCount:
          type: integer

    DirectMessage:
      type: object
      properties:
        id:
          type: string
        from:
          type: string
        to:
          type: string
        content:
          type: string
          description: Decrypted message content
        createdAt:
          type: integer

    # =========================================================================
    # Contacts
    # =========================================================================

    Contact:
      type: object
      required: [pubkey]
      properties:
        pubkey:
          type: string
          description: Public key of the contact
        relay:
          type: string
          description: Recommended relay URL for this contact (optional)
        petname:
          type: string
          description: Local nickname for this contact (optional)

    AppDefinition:
      type: object
      description: Metadata for a Mirage application
      required: [naddr, name, createdAt]
      properties:
        naddr:
          type: string
          description: Bech32 address for the application (NIP-19)
          example: "naddr1..."
        name:
          type: string
          description: Custom name for the application
          example: "My Awesome App"
        createdAt:
          type: integer
          description: Unix timestamp of when the app was added/published
          example: 1703635200
